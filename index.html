<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoReflect - AP Human Geography Practice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300..900;1,9..144,300..900&family=Source+Sans+3:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Topographic background pattern -->
    <div class="topo-bg"></div>

    <!-- API Key Modal -->
    <div class="modal-overlay" id="apiModal">
        <div class="modal">
            <div class="modal-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                </svg>
            </div>
            <h2>Welcome to GeoReflect</h2>
            <p>To get started, you'll need a free Gemini API key from Google AI Studio.</p>

            <div class="api-steps">
                <div class="step">
                    <span class="step-num">1</span>
                    <span>Visit <a href="https://aistudio.google.com/" target="_blank" rel="noopener">Google AI Studio</a></span>
                </div>
                <div class="step">
                    <span class="step-num">2</span>
                    <span>Sign in with your Google account</span>
                </div>
                <div class="step">
                    <span class="step-num">3</span>
                    <span>Click "Get API Key" → "Create API Key"</span>
                </div>
                <div class="step">
                    <span class="step-num">4</span>
                    <span>Copy and paste your key below</span>
                </div>
            </div>

            <div class="api-input-group">
                <input type="password" id="apiKeyInput" placeholder="Paste your API key here..." autocomplete="off">
                <button class="toggle-visibility" id="toggleKey" type="button">
                    <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                        <line x1="1" y1="1" x2="23" y2="23"/>
                    </svg>
                </button>
            </div>

            <button class="btn btn-primary" id="saveApiKey">
                <span>Start Practicing</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>

            <p class="privacy-note">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                Your API key is stored locally in your browser and never sent to our servers.
            </p>
        </div>
    </div>

    <!-- Question Library Modal -->
    <div class="modal-overlay hidden" id="questionModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2>Question Library</h2>
                <button class="modal-close" id="closeQuestionModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>

            <!-- Filters -->
            <div class="question-filters">
                <div class="filter-group">
                    <label for="unitFilter">Unit</label>
                    <select id="unitFilter">
                        <option value="all">All Units</option>
                        <option value="1">Unit 1: Thinking Geographically</option>
                        <option value="2">Unit 2: Population & Migration</option>
                        <option value="3">Unit 3: Cultural Patterns</option>
                        <option value="4">Unit 4: Political Patterns</option>
                        <option value="5">Unit 5: Agriculture</option>
                        <option value="6">Unit 6: Cities & Urban Land-Use</option>
                        <option value="7">Unit 7: Industrial & Economic Development</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="skillFilter">Skill Type</label>
                    <select id="skillFilter">
                        <option value="all">All Skills</option>
                        <option value="Analyze Patterns">Analyze Patterns</option>
                        <option value="Explain Processes">Explain Processes</option>
                        <option value="Cause & Effect">Cause & Effect</option>
                        <option value="Compare Regions">Compare Regions</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="difficultyFilter">Difficulty</label>
                    <select id="difficultyFilter">
                        <option value="all">All Levels</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <!-- Question Count -->
            <div class="question-count">
                <span id="questionCount">0</span> questions found
            </div>

            <!-- Question List -->
            <div class="question-list" id="questionList">
                <!-- Questions will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app" id="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 40 40" fill="none">
                        <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2"/>
                        <path d="M20 2C20 2 8 12 8 20s12 18 12 18" stroke="currentColor" stroke-width="2"/>
                        <path d="M20 2C20 2 32 12 32 20s-12 18-12 18" stroke="currentColor" stroke-width="2"/>
                        <line x1="2" y1="20" x2="38" y2="20" stroke="currentColor" stroke-width="2"/>
                        <ellipse cx="20" cy="12" rx="10" ry="4" stroke="currentColor" stroke-width="1.5"/>
                        <ellipse cx="20" cy="28" rx="10" ry="4" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <span class="logo-name">GeoReflect</span>
                    <span class="logo-tagline">AP Human Geography Practice</span>
                </div>
            </div>
            <button class="btn btn-ghost" id="settingsBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v6m0 6v10M4.22 4.22l4.24 4.24m7.08 7.08l4.24 4.24M1 12h6m6 0h10M4.22 19.78l4.24-4.24m7.08-7.08l4.24-4.24"/>
                </svg>
                <span>Settings</span>
            </button>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Practice Panel -->
            <section class="panel practice-panel" id="practicePanel">
                <div class="panel-header">
                    <div class="panel-badge">Practice Mode</div>
                    <h1>Write Your Skill Reflection</h1>
                    <p>Enter a question, write your response, and get instant AI-powered feedback.</p>
                </div>

                <!-- Question Section -->
                <div class="input-section">
                    <div class="question-header">
                        <label class="input-label">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            Your Question
                        </label>
                        <button class="btn btn-secondary" id="browseQuestionsBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                            </svg>
                            Browse Questions
                        </button>
                    </div>
                    <textarea
                        id="questionInput"
                        class="textarea question-textarea"
                        placeholder="Paste or type your AP Human Geography question here...

Or click 'Browse Questions' to choose from our question library."
                    ></textarea>

                    <!-- Image Upload -->
                    <div class="image-upload-area" id="imageUploadArea">
                        <input type="file" id="imageInput" accept="image/*" hidden>
                        <div class="upload-prompt" id="uploadPrompt">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <span>Add an image (map, chart, or data table)</span>
                            <span class="upload-hint">Click or drag & drop</span>
                        </div>
                        <div class="image-preview" id="imagePreview" hidden>
                            <img id="previewImg" src="" alt="Question image">
                            <button class="remove-image" id="removeImage">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Response Section -->
                <div class="input-section">
                    <label class="input-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                            <path d="M2 2l7.586 7.586"/>
                            <circle cx="11" cy="11" r="2"/>
                        </svg>
                        Your Response
                    </label>
                    <textarea
                        id="responseInput"
                        class="textarea response-textarea"
                        placeholder="Write your skill reflection here...

Remember to include:
• A clear claim/thesis that answers the question
• Specific evidence with real examples
• Reasoning that explains HOW and WHY
• Geographic vocabulary (push factors, urbanization, etc.)"
                    ></textarea>
                    <div class="textarea-footer">
                        <div class="word-count">
                            <span id="wordCount">0</span> words
                        </div>
                        <div class="auto-save" id="autoSaveStatus">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span>Auto-saved</span>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button class="btn btn-submit" id="submitBtn">
                    <span class="btn-text">Get My Score & Feedback</span>
                    <span class="btn-loading">
                        <span class="spinner"></span>
                        Analyzing your response...
                    </span>
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13"/>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                    </svg>
                </button>
            </section>

            <!-- Results Panel -->
            <section class="panel results-panel" id="resultsPanel" hidden>
                <button class="back-btn" id="backBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                    <span>Practice Again</span>
                </button>

                <!-- Score Display -->
                <div class="score-display">
                    <div class="score-circle">
                        <svg class="score-ring" viewBox="0 0 120 120">
                            <circle class="score-ring-bg" cx="60" cy="60" r="54"/>
                            <circle class="score-ring-fill" cx="60" cy="60" r="54" id="scoreRing"/>
                        </svg>
                        <div class="score-value">
                            <span class="score-num" id="scoreNum">0</span>
                            <span class="score-max">/20</span>
                        </div>
                    </div>
                    <div class="score-message" id="scoreMessage">Analyzing...</div>
                </div>

                <!-- Rubric Breakdown -->
                <div class="rubric-breakdown">
                    <h3>Score Breakdown</h3>
                    <div class="rubric-grid">
                        <div class="rubric-item" id="rubricClaim">
                            <div class="rubric-header">
                                <span class="rubric-name">Claim/Thesis</span>
                                <span class="rubric-score"><span class="rubric-earned">0</span>/2</span>
                            </div>
                            <div class="rubric-bar">
                                <div class="rubric-fill"></div>
                            </div>
                            <p class="rubric-comment"></p>
                        </div>
                        <div class="rubric-item" id="rubricEvidence">
                            <div class="rubric-header">
                                <span class="rubric-name">Evidence</span>
                                <span class="rubric-score"><span class="rubric-earned">0</span>/6</span>
                            </div>
                            <div class="rubric-bar">
                                <div class="rubric-fill"></div>
                            </div>
                            <p class="rubric-comment"></p>
                        </div>
                        <div class="rubric-item" id="rubricReasoning">
                            <div class="rubric-header">
                                <span class="rubric-name">Reasoning</span>
                                <span class="rubric-score"><span class="rubric-earned">0</span>/6</span>
                            </div>
                            <div class="rubric-bar">
                                <div class="rubric-fill"></div>
                            </div>
                            <p class="rubric-comment"></p>
                        </div>
                        <div class="rubric-item" id="rubricRealism">
                            <div class="rubric-header">
                                <span class="rubric-name">Realism of Facts</span>
                                <span class="rubric-score"><span class="rubric-earned">0</span>/2</span>
                            </div>
                            <div class="rubric-bar">
                                <div class="rubric-fill"></div>
                            </div>
                            <p class="rubric-comment"></p>
                        </div>
                        <div class="rubric-item" id="rubricTerms">
                            <div class="rubric-header">
                                <span class="rubric-name">Geographic Terms</span>
                                <span class="rubric-score"><span class="rubric-earned">0</span>/4</span>
                            </div>
                            <div class="rubric-bar">
                                <div class="rubric-fill"></div>
                            </div>
                            <p class="rubric-comment"></p>
                        </div>
                    </div>
                </div>

                <!-- Strengths -->
                <div class="feedback-section strengths-section">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                        What You Did Well
                    </h3>
                    <ul class="feedback-list" id="strengthsList"></ul>
                </div>

                <!-- Improvements -->
                <div class="feedback-section improvements-section">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="20" x2="12" y2="10"/>
                            <line x1="18" y1="20" x2="18" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="16"/>
                        </svg>
                        How to Improve
                    </h3>
                    <div class="improvements-list" id="improvementsList"></div>
                </div>

                <!-- Encouragement -->
                <div class="encouragement-banner" id="encouragementBanner">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    <p id="encouragementText"></p>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Built for AP Human Geography students. Practice makes progress!</p>
        </footer>
    </div>

    <!-- Error Toast -->
    <div class="toast" id="errorToast">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span id="errorMessage"></span>
    </div>

    <script src="config.js"></script>
    <script type="module" src="gemini.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
